<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/gameNav.css}">
    <link rel="stylesheet" th:href="@{/css/gameDetail.css}">
    <link rel="stylesheet" th:href="@{/css/buttons.css}">
<!--    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<body>
<div th:replace="/components/header :: header"></div>
<div th:replace="/components/gameNav :: gameNav"></div>
<div id="game-detail-section">
    <!-- Container for the image gallery -->
    <div class="container">

        <!-- Full-width images with number text -->
        <div th:each="fileName: ${game.storedFileName}" class="mySlides">
            <img id="thumbnail" th:src="@{|/upload/${fileName}}" style="width: 1154px; height: 725px; object-fit: cover">
        </div>

<!--        <div class="mySlides">-->
<!--            <div class="numbertext">2 / 6</div>-->
<!--            <img src="img_5terre_wide.jpg" style="width:100%">-->
<!--        </div>-->

<!--        <div class="mySlides">-->
<!--            <div class="numbertext">3 / 6</div>-->
<!--            <img src="img_mountains_wide.jpg" style="width:100%">-->
<!--        </div>-->

<!--        <div class="mySlides">-->
<!--            <div class="numbertext">4 / 6</div>-->
<!--            <img src="img_lights_wide.jpg" style="width:100%">-->
<!--        </div>-->

<!--        <div class="mySlides">-->
<!--            <div class="numbertext">5 / 6</div>-->
<!--            <img src="img_nature_wide.jpg" style="width:100%">-->
<!--        </div>-->

<!--        <div class="mySlides">-->
<!--            <div class="numbertext">6 / 6</div>-->
<!--            <img src="img_snow_wide.jpg" style="width:100%">-->
<!--        </div>-->

        <!-- Next and previous buttons -->
        <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
        <a class="next" onclick="plusSlides(1)">&#10095;</a>

        <!-- Image text -->
        <div class="caption-container">
            <p id="caption"></p>
        </div>

        <!-- Thumbnail images -->
        <div class="row">
            <div th:each="fileName: ${game.storedFileName}" class="column">
                <img class="demo cursor" th:src="@{|/upload/${fileName}}" style="width:200px; height: 122px; object-fit:fill" onclick="currentSlide(i)" alt="">
            </div>
<!--            <div class="column">-->
<!--                <img class="demo cursor" src="img_5terre.jpg" style="width:100%" onclick="currentSlide(2)" alt="Cinque Terre">-->
<!--            </div>-->
<!--            <div class="column">-->
<!--                <img class="demo cursor" src="img_mountains.jpg" style="width:100%" onclick="currentSlide(3)" alt="Mountains and fjords">-->
<!--            </div>-->
<!--            <div class="column">-->
<!--                <img class="demo cursor" src="img_lights.jpg" style="width:100%" onclick="currentSlide(4)" alt="Northern Lights">-->
<!--            </div>-->
<!--            <div class="column">-->
<!--                <img class="demo cursor" src="img_nature.jpg" style="width:100%" onclick="currentSlide(5)" alt="Nature and sunrise">-->
<!--            </div>-->
<!--            <div class="column">-->
<!--                <img class="demo cursor" src="img_snow.jpg" style="width:100%" onclick="currentSlide(6)" alt="Snowy Mountains">-->
<!--            </div>-->
        </div>
    </div>
</div>

<table>
    <tr>
        <th>등록 번호</th>
        <td th:text="${game.id}"></td>
    </tr>
    <tr>
        <th>게임 제목</th>
        <td th:text="${game.gameTitle}"></td>
    </tr>
    <tr>
        <th>게임 장르</th>
        <td th:text="${game.gameGenre}"></td>
    </tr>
    <tr>
        <td>게임 제작사</td>
        <td th:text="${game.gameCreator}"></td>
    </tr>
    <tr>
        <td>게임 배급사</td>
        <td th:text="${game.gameDistr}"></td>
    </tr>
    <tr>
        <td>게임 설명</td>
        <td th:utext="${game.gameIntro}"></td>
    </tr>
    <tr>
        <td>출시 가격</td>
        <td th:text="${game.releasePrice}"></td>
    </tr>
    <tr>
        <td>할인율</td>
        <td th:text="${game.discountRate}"></td>
    </tr>
    <tr>
        <td>판매 가격</td>
        <td th:text="${game.salesPrice}"></td>
    </tr>
    <tr th:if="${game.fileAttached==1}">
        <th>사진</th>
        <td>
            <div th:each="fileName: ${game.storedFileName}">
                <img th:src="@{|/upload/${fileName}}" width="200" height="200" alt="">
            </div>
        </td>
    </tr>
    <tr th:if="${game.youtubeUrl != ''}">
        <td>영상</td>
        <td>
            <div id="youtubeContainer">
                <p th:value="${game.youtubeUrl}"></p>
                <iframe id="youtubeIframe" type="text/html" width="720" height="405"
                        th:src="'https://www.youtube.com/embed/' + ${game.youtubeUrl}"
                        frameborder="0" allowfullscreen>
                </iframe>
            </div>
        </td>
    </tr>
</table>
<div class="container">
    <button onclick="game_List()">목록</button>
    <button onclick="game_Update()">수정</button>
    <button onclick="game_Delete()">삭제</button>
</div>
<div id="pass-check">
</div>
<div class="container" id="review-write">
    <input type="text" id="review-writer" placeholder="작성자">
    <input type="text" id="review-contents" placeholder="내용">
    <button onclick="review_write()">리뷰작성</button>
</div>
<div class="container" id="review-list">
    <div th:if="${gameReviewList == null}">
        <p>작성된 리뷰가 없습니다.</p>
    </div>
    <div th:unless="${gameReviewList==null}">
        <table class="table">
            <tr>
                <th>리뷰번호</th>
                <th>작성자</th>
                <th>리뷰내용</th>
                <th>작성날짜</th>
            </tr>
            <tr th:each="gameReview:${gameReviewList}">
                <td th:text="${gameReview.id}"></td>
                <td th:text="${gameReview.reviewWriter}"></td>
                <td th:text="${gameReview.reviewContents}"></td>
                <td th:text="${gameReview.createdAt}"></td>
            </tr>
        </table>
    </div>
</div>
</div>
<div th:replace="/components/footer :: footer"></div>
</body>
<script th:inline="javascript">
    const review_list = (gameReviewList) => {
        const resultArea = document.querySelector("#review-list");
        let output = "<table class=\"table table-primary\">\n" +
            "    <tr>\n" +
            "        <th>글 번호</th>\n" +
            "        <th>제목</th>\n" +
            "        <th>작성자</th>\n" +
            "        <th>작성 일자</th>\n" +
            "    </tr>"
        for (let i in gameReviewList) {
            output += "<tr>\n" +
                "                    <td>" + gameReviewList[i].id + "</td>\n" +
                "                    <td>" + gameReviewList[i].reviewWriter + "</td>\n" +
                "                    <td>" + gameReviewList[i].reviewContents + "</td>\n" +
                "                    <td>" + gameReviewList[i].createdAt + "</td>\n" +
                "                </tr>";
        }
        output += "</table>";
        resultArea.innerHTML = output;
    }
    const review_write = () => {
        const writer = document.querySelector("#review-writer").value;
        const contents = document.querySelector("#review-contents").value;
        const gameId = [[${game.id}]]
        axios({
            method: "post",
            url: "/review/save",
            data: {
                reviewWriter: writer,
                reviewContents: contents,
                gameId: gameId
            }
        }).then(res => {
            document.querySelector("#review-writer").value = "";
            document.querySelector("#review-contents").value = "";
            review_list(res.data);
        }).catch(err => {
            console.log("err", err);
        });

    }
    const game_List = () => {
        const page = [[${page}]];
        const type = [[${type}]];
        const q = [[${q}]]
        location.href = "/game?page=" + page + "&type=" + type + "&q=" + q;
    }
    const game_Update = () => {
        const id = [[${game.id}]]
        location.href = "/game/update/" + id;
    }
    const game_Delete = () => {
        const id = [[${game.id}]]
        location.href = "/game/delete/" + id;
    }

    document.addEventListener("DOMContentLoaded", function () {
        const youtubeUrl = 'https://www.youtube.com/embed/' + [[${game.youtubeUrl}]];
        const youtubeIframe = document.getElementById("youtubeIframe");

        // 비디오의 유효성을 확인하고 숨깁니다.
        if (isYouTubeVideoValid(youtubeUrl)) {
            youtubeIframe.style.display = "block";
        } else {
            youtubeIframe.style.display = "none";
        }
    });

    function isYouTubeVideoValid(url) {
        // 유효한 유튜브 URL인지 확인하는 로직을 구현합니다.
        // 정규식을 사용하여 URL의 유효성을 확인합니다.
        // 유효한 URL 패턴: https://www.youtube.com/embed/xxxxxxxxxxx (x는 알파벳 대소문자와 숫자)
        const youtubePattern = /^https?:\/\/www\.youtube\.com\/embed\/[a-zA-Z0-9_-]{11}$/;
        return youtubePattern.test(url);
    }

    // 이미지 슬라이드쇼
    let slideIndex = 1;
    showSlides(slideIndex);

    // Next/previous controls
    function plusSlides(n) {
        showSlides(slideIndex += n);
    }

    // Thumbnail image controls
    function currentSlide(n) {
        showSlides(slideIndex = n);
    }

    function showSlides(n) {
        let i;
        let slides = document.getElementsByClassName("mySlides");
        let dots = document.getElementsByClassName("demo");
        let captionText = document.getElementById("caption");
        if (n > slides.length) {slideIndex = 1}
        if (n < 1) {slideIndex = slides.length}
        for (i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
        }
        for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(" active", "");
        }
        slides[slideIndex-1].style.display = "block";
        dots[slideIndex-1].className += " active";
        captionText.innerHTML = dots[slideIndex-1].alt;
    }



</script>
</html>